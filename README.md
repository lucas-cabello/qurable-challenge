
# Qurable Challenge: Coupon Redemption System

## Project setup

```bash
$ npm install
```

## Run the project

```bash
# development
$ npm run start
```

## Development

The proposed solution to the coupon redemption system consist of a NestJS API connected to a MongoDB database.

The DB stores two main entities with embedded documents for the coupons:

User
```json
{
  "firstname": string,
  "lastname": string,
  "email": string,
  "coupons": UserCoupon[],
}
```
UserCoupon (Embedded)
```json
{
  "code": string,
  "discount": number,
  "used": boolean,
  "couponBookId": string,
}
```
CouponBook
```json
{
  "name": string,
  "description": string,
  "maxCouponAmount": number,
  "maxCouponPerUser": number,
  "coupons": Coupon[],
}
```
Coupon (Embedded)
```json
{
  "code": string,
  "discount": number,
  "used": boolean,
  "userId": string,
}
```

CouponBook is the aggregate that handles the coupon creation, assignment and redeem logic. It contains the maxCouponAmount and maxCouponPerUser
properties that enforce the business rules that restrict the creation and assignment of coupons.

User holds the list of coupons assigned to the user but doesn't enforce any rule, it's just to be able to list the coupons used or assigned
to a certain user in a more performant way.

In the [coupon-book.service.ts](./src/coupon-book/coupon-book.service.ts) resides the main logic that enforces the business rules defined in
the requirements. The queries implemented in the methods assignCoupon and redeemCoupon are designed to check the constraints and update in
the same atomic operation so that concurrent updates won't cause problems. 

### Requested solution

In this challenge, you'll be designing and implementing a coupon redemption system to be
integrated into an existing checkout cart for an eCommerce platform. You do not need to
build the entire checkout cart (you can mock the experience)â€”the checkout flow
already exists, and your task is to implement the functionality where users can apply a
coupon code to receive a discount.
Coupons can offer various discount percentages (e.g., 5%, 10%, 20%), and must be validated
based on availability and specific rules. The system will manage coupon codes, track their
usage, and ensure that once a coupon is redeemed, it cannot be reused. You will also need to
handle the assignment of gift cards (as new coupon codes) after a purchase is completed.
After a purchase is completed, the system should assign a gift card to the user in the form of
a coupon code. The gift card can be:
- Randomly generated by the system, or .
- Explicitly assigned by the eCommerce system (non-random).

### Functional Specs:

1. Users can input coupon codes to receive a discount during checkout.
2. After a successful purchase, a gift card (new coupon code) will be automatically generated or assigned to the user .
3. Coupon Redemption:
    1. A user should be able to redeem a coupon by providing its code.
    2. A redeemed coupon cannot be reused.
    3. The system should allow for both assigning and redeeming a coupon in a single operation if required.
4. Coupon Inventory:
    1. A maximum number of coupons per user must be specified.
    2. A maximum number of coupons per coupon book must be specified.

### Additional Considerations:

1. You can design a website + middleware or just an API
2. SQL or NoSQL databases can be used for the exercise
3. Do not overdesign, keep it simple, but think about scalability and potential challenges
4. Identify key technical problems in the challenge
5. You can skip adding styles to the website or choose something basic
6. You can make assumptions or hypotheses to move forward if something is unclear
7. You can ask questions to the team as many times as needed if you have doubts (there is no limit on the number of questions)
8. Feel free to use AI to help, but be prepared to be asked questions and go deep on the technical challenges and what if scenarios

### Deliverables:

1. Pseudo code or Source Code (github preferred). Pseudocode is fine
2. Description of the solution
3. Ability to discuss and go deep on how the system would operate efficiently under
   high load, with many users interacting simultaneously and if implementing this
   solution in real life
4. Expected Stack: Node, TS
